mean(data)
knitr::opts_chunk$set(echo = TRUE)
library(tinytex)
library(ggplot2)
set.seed(121212)
gamma <- 2
phi <- 0.5
curve(dgamma(x, gamma, phi), xlim=c(0, 15), n=10000, xlab=expression(paste(lambda,"_2")), ylab="density", main=expression(paste("Distribution of ", lambda,"_2")))
gamma <- 2
phi <- 0.5
gamma.p.2 <- gamma + 102
phi.p.2 <- phi + 37
gamma.p.2
phi.p.2
gamma.p.1 <- gamma + 185
phi.p.1 <- phi + 41
samp_1 <- rgamma(10000,gamma.p.1,phi.p.1)
samp_2 <- rgamma(10000,gamma.p.2,phi.p.2)
diff <- samp_1 - samp_2
quantile(diff, c(0.025, 0.975))
variance <- 0.821
lambda <- 6
tau2 <- 10
data_sum <- 1244
n <- 232
lambda.p <- (tau2*data_sum + (variance * lambda)) / (tau2*n + variance)
tau2.p <- (variance * tau2) / (tau2*n + variance)
lambda.p
tau2.p
curve(dnorm(x, lambda.p, sqrt(tau2.p)), xlim=c(5.1,5.6), n=10000, xlab=expression(paste("log(SOC) of Farmland")), ylab="density", main=expression(paste("Distribution of log(SOC) of Farmland")))
qnorm(c(.025, .975), lambda.p, sqrt(tau2.p))
norm.F <- rnorm(10000, lambda.p, sqrt(tau2.p))
quantile(norm.F, c(.025, .975))
exp(quantile(norm.F, c(.025, .975)))
variance.w <- 1.51
lambda.w <- 6
tau2.w <- 10
data_sum.w <- 403
n.w <- 67
lambda.p.w <- (tau2.w*data_sum.w + (variance.w * lambda.w)) / (tau2.w*n.w + variance.w)
tau2.p.w <- (variance.w * tau2.w) / (tau2.w*n.w + variance.w)
norm.w <- rnorm(10000, lambda.p.w, sqrt(tau2.p.w))
exp(quantile(norm.w, c(.025, .975)))
sick <- rbeta(10000,(3 * 35) + 0.65,4.35 + 192)
final <- (3 / sick) - 3
quantile(final, c(0.025,0.975))
knitr::opts_chunk$set(echo = TRUE)
library(tinytex)
library(ggplot2)
set.seed(121212)
gamma <- 2
phi <- 0.5
curve(dgamma(x, gamma, phi), xlim=c(0, 15), n=10000, xlab=expression(paste(lambda,"_2")), ylab="density", main=expression(paste("Distribution of ", lambda,"_2")))
gamma <- 2
phi <- 0.5
gamma.p.2 <- gamma + 102
phi.p.2 <- phi + 37
gamma.p.2
phi.p.2
gamma.p.1 <- gamma + 185
phi.p.1 <- phi + 41
samp_1 <- rgamma(10000,gamma.p.1,phi.p.1)
samp_2 <- rgamma(10000,gamma.p.2,phi.p.2)
diff <- samp_1 - samp_2
quantile(diff, c(0.025, 0.975))
variance <- 0.821
lambda <- 6
tau2 <- 10
data_sum <- 1244
n <- 232
lambda.p <- (tau2*data_sum + (variance * lambda)) / (tau2*n + variance)
tau2.p <- (variance * tau2) / (tau2*n + variance)
lambda.p
tau2.p
curve(dnorm(x, lambda.p, sqrt(tau2.p)), xlim=c(5.1,5.6), n=10000, xlab=expression(paste("log(SOC) of Farmland")), ylab="density", main=expression(paste("Distribution of log(SOC) of Farmland")))
qnorm(c(.025, .975), lambda.p, sqrt(tau2.p))
norm.F <- rnorm(10000, lambda.p, sqrt(tau2.p))
quantile(norm.F, c(.025, .975))
exp(quantile(norm.F, c(.025, .975)))
variance.w <- 1.51
lambda.w <- 6
tau2.w <- 10
data_sum.w <- 403
n.w <- 67
lambda.p.w <- (tau2.w*data_sum.w + (variance.w * lambda.w)) / (tau2.w*n.w + variance.w)
tau2.p.w <- (variance.w * tau2.w) / (tau2.w*n.w + variance.w)
norm.w <- rnorm(10000, lambda.p.w, sqrt(tau2.p.w))
exp(quantile(norm.w, c(.025, .975)))
sick <- rbeta(10000,(3 * 35) + 0.65,4.35 + 192)
final <- (3 / sick) - 3
quantile(final, c(0.025,0.975))
library(lookup)
library(tidyverse)
library(rvest)
library(lubridate)
library(readxl)
library(dplyr)
library(readxl)
library(aod)
library(ggplot2)
library(tidyr)
library(stringr)
library(lookup)
library(reshape)
library(coda)
playoff_games <- read.csv('playoff_games.csv')
playoff_games <- read.csv('/Users/matty/Documents/BYU/undergrad_research/old_data/playoff_games.csv')
regular_season <- read.csv('/Users/matty/Documents/BYU/undergrad_research/old_data/regular_season.csv')
names <- c('Visitor/Neutral','Visitor Points','Home/Neutral','Home Points','id','year','win','team','season_id','margin','playoff')
names(regular_season) <- names
names(playoff_games) <- names
view(playoff_games)
names(playoff_games) <- names
playoff_games[substr(playoff_games$year, 1, 3) == "198", ]
the80s <- playoff_games
the80s$correct <- playoff_games[substr(playoff_games$year, 1, 3) == "198", ]
playoff_games %>%
filter(substr(year) == '198',)
playoff_games %>%
filter(substr(year) == '198')
playoff_games %>%
filter(substr(year,1,3) == '198')
playoff_games %>%
filter(substr(year,1,3) == '198') %>%
select(everything())
playoff_games$year == '198'
playoff_games$year == '198',
playoff_games$year > 198
playoff_games$year >= 1980 && playoff_games$year <= 1990
playoff_games$year >= 1980 &&  <= 1990
temp <- playoff_games$year >= 1980
temp <- playoff_games <= 1990
temp
the80s <- playoff_games
the80s$correct <- temp
the 80s
the80s
view(the80s)
temp
view(temp)
temp <- playoff_games$year >= 1980
temp <- playoff_games$year <= 1990
view(temp)
the80s <- playoff_games
the80s$correct <- temp
view(the80s)
filter(the80s,correct == T)
view(filter(the80s,correct == T))
temp <- playoff_games$year >= 1980
temp <- playoff_games$year < 1990
view(temp)
temp <- playoff_games$year < 1990
the80s <- playoff_games
the80s$correct <- temp
view(filter(the80s,correct == T))
filter_teams <- function(first,last,df){
temp <- playoff_games$year >= first
temp <- playoff_games$year < last
df <- playoff_games
df$correct <- temp
}
playoff_games <- read.csv('/Users/matty/Documents/BYU/undergrad_research/old_data/playoff_games.csv')
regular_season <- read.csv('/Users/matty/Documents/BYU/undergrad_research/old_data/regular_season.csv')
names <- c('Visitor/Neutral','Visitor Points','Home/Neutral','Home Points','id','year','win','team','season_id','margin','playoff')
names(regular_season) <- names
names(playoff_games) <- names
filter_teams <- function(first,last,df){
temp <- playoff_games$year >= first
temp <- playoff_games$year < last
df <- playoff_games
df$correct <- temp
}
filter_teams(1980,1990,the80s)
view(the80s)
the80s <- data.frame()
filter_teams(1980,1990,the80s)
filter_teams <- function(first,last,df){
temp <- playoff_games$year >= first
temp <- playoff_games$year < last
df <- playoff_games
df$correct <- temp
return(df)
}
filter_teams(1980,1990,the80s)
the80s <- filter_teams(1980,1990,the80s)
view(the80s)
the90s <- filter_teams(1990,2000)
view(the90s)
the90s <- filter_teams(1990,2000)
view(the90s)
temp <- playoff_games$year >= 1990
temp <- playoff_games$year < 2000
test <- playoff_games
test$correct <- temp
view(filter(test,correct == T))
temp <- playoff_games$year >= 1990 & playoff_games$year < 2000
test <- playoff_games
test$correct <- temp
view(filter(test,correct == T))
the80s <- filter_teams(1980,1990)
the90s <- filter_teams(1990,2000)
view(the80s)
view(the90s)
playoff_games <- read.csv('/Users/matty/Documents/BYU/undergrad_research/old_data/playoff_games.csv')
regular_season <- read.csv('/Users/matty/Documents/BYU/undergrad_research/old_data/regular_season.csv')
names <- c('Visitor/Neutral','Visitor Points','Home/Neutral','Home Points','id','year','win','team','season_id','margin','playoff')
names(regular_season) <- names
names(playoff_games) <- names
filter_teams <- function(first,last){
temp <- playoff_games$year >= first & playoff_games$year < last
df <- playoff_games
df$correct <- temp
return(df)
}
filter_teams <- function(first,last){
temp <- playoff_games$year >= first & playoff_games$year < last
df <- playoff_games
df$correct <- temp
return(df)
}
the80s <- filter_teams(1980,1990)
the90s <- filter_teams(1990,2000)
view(the90s)
temp <- playoff_games$year >= 1990 & playoff_games$year < 2000
temp <- playoff_games$year < 2000
test <- playoff_games
temp <- playoff_games$year >= 1990 & playoff_games$year < 2000
test <- playoff_games
test$correct <- temp
view(filter(test,correct == T))
filter_teams <- function(first,last){
temp <- playoff_games$year >= 1990 & playoff_games$year < 2000
test <- playoff_games
test$correct <- temp
return(test)
}
the80s <- filter_teams(1980,1990)
the90s <- filter_teams(1990,2000)
view(the90s)
please <- filter_teams(1990,2000)
view(please)
playoff_games$year >= 1990 & playoff_games$year < 2000
playoff_games
filter_teams <- function(first,last){
temp <- playoff_games$year >= first & playoff_games$year < last
test <- playoff_games
test$correct <- temp
df <- filter(test,correct == T)
return(df)
}
please <- filter_teams(1990,2000)
view(please)
the80s <- filter_teams(1980,1990)
the90s <- filter_teams(1990,2000)
playoff_games
playoff_games$`Visitor/Neutral` == 'BOS'
playoff_games$`Visitor/Neutral` == 'LOS'
playoff_games$`Visitor/Neutral` == 'LAL'
playoff_games$`Home/Neutral` == 'LAL'
playoff_games$`Visitor/Neutral` == 'BOS'
playoff_games$`Home/Neutral` == 'BOS'
playoff_games$`Visitor/Neutral` == 'DET'
playoff_games$`Home/Neutral` == 'DET'
playoff_games$`Visitor/Neutral` == 'LAL' | playoff_games$`Home/Neutral` == 'LAL' | playoff_games$`Visitor/Neutral` == 'BOS' | playoff_games$`Home/Neutral` == 'BOS' | playoff_games$`Visitor/Neutral` == 'DET' | playoff_games$`Home/Neutral` == 'DET'
temp2 <- playoff_games$`Visitor/Neutral` == 'LAL' | playoff_games$`Home/Neutral` == 'LAL' | playoff_games$`Visitor/Neutral` == 'BOS' | playoff_games$`Home/Neutral` == 'BOS' | playoff_games$`Visitor/Neutral` == 'DET' | playoff_games$`Home/Neutral` == 'DET'
test$cteams <- temp2
view(filter(test,correct == T & cteams == T))
filter_teams1 <- function(first,last,part,team1,team2,team3){
temp <- part$year >= first & part$year < last
test <- part
test$correct <- temp
temp2 <- playoff_games$`Visitor/Neutral` == team1 | playoff_games$`Home/Neutral` == team1 | playoff_games$`Visitor/Neutral` == team2 | playoff_games$`Home/Neutral` == team2 | playoff_games$`Visitor/Neutral` == team3 | playoff_games$`Home/Neutral` == team3
test$cteams <- temp2
df <- filter(test,correct == T & cteams == T)
return(df)
}
the80s <- filter_teams(1980,1990,'BOS','LAL','DET')
the80s <- filter_teams1(1980,1990,'BOS','LAL','DET')
the80s <- filter_teams1(1980,1990,playoff_games,'BOS','LAL','DET')
view(the80s)
library(lookup)
library(tidyverse)
library(rvest)
library(lubridate)
library(readxl)
library(dplyr)
library(readxl)
library(aod)
library(ggplot2)
library(tidyr)
library(stringr)
library(lookup)
library(reshape)
library(coda)
setwd('/Users/matty/Documents/BYU/undergrad_research/filter')
playoff_games <- read.csv('/Users/matty/Documents/BYU/undergrad_research/old_data/playoff_games.csv')
regular_season <- read.csv('/Users/matty/Documents/BYU/undergrad_research/old_data/regular_season.csv')
names <- c('Visitor/Neutral','Visitor Points','Home/Neutral','Home Points','id','year','win','team','season_id','margin','playoff')
names(regular_season) <- names
names(playoff_games) <- names
filter_teams1 <- function(first,last,part,team1,team2,team3){
temp <- part$year >= first & part$year < last
test <- part
test$correct <- temp
temp2 <- part$`Visitor/Neutral` == team1 | part$`Home/Neutral` == team1 | part$`Visitor/Neutral` == team2 | part$`Home/Neutral` == team2 | part$`Visitor/Neutral` == team3 | part$`Home/Neutral` == team3
test$cteams <- temp2
df <- filter(test,correct == T & cteams == T)
return(df)
}
filter_teams2 <- function(first,last,part,team1,team2,team3,team4){
temp <- part$year >= first & part$year < last
test <- part
test$correct <- temp
temp2 <- part$`Visitor/Neutral` == team1 | part$`Home/Neutral` == team1 | part$`Visitor/Neutral` == team2 | part$`Home/Neutral` == team2 | part$`Visitor/Neutral` == team3 | part$`Home/Neutral` == team3 | part$`Visitor/Neutral` == team4 | part$`Home/Neutral` == team4
test$cteams <- temp2
df <- filter(test,correct == T & cteams == T)
return(df)
}
cleaning <- function(decade,team,list){
temp <- decade
temp$teamer <- temp$`Visitor/Neutral` == team | temp$`Home/Neutral` == team
temp <- filter(temp,teamer == T)
holder <- 1
for(i in unique(temp$year)){
curr <- temp[temp$year == i, ]
curr <- curr[,1:10]
list[[holder]] <- curr
holder <- holder + 1
}
return(list)
}
my_list <- list()
reg80 <- filter_teams1(1980,1990,regular_season,'BOS','DET','LAL')
post80 <- filter_teams1(1980,1990,playoff_games,'BOS','DET','LAL')
reg.lal.80 <- cleaning(reg80,'LAL',my_list)
post.lal.80 <- cleaning(post80,'LAL',my_list)
reg.bos.80 <- cleaning(reg80,'BOS',my_list)
post.bos.80 <- cleaning(post80,'BOS',my_list)
reg.det.80 <- cleaning(reg80,'DET',my_list)
post.det.80 <- cleaning(post80,'DET',my_list)
reg90 <- filter_teams1(1990,2000,regular_season,'HOU','CHI','UTA')
post90 <- filter_teams1(1990,2000,playoff_games,'HOU','CHI','UTA')
reg.hou.90 <- cleaning(reg90,'HOU',my_list)
post.hou.90 <- cleaning(post90,'HOU',my_list)
reg.chi.90 <- cleaning(reg90,'CHI',my_list)
post.chi.90 <- cleaning(post90,'CHI',my_list)
reg.uta.90 <- cleaning(reg90,'UTA',my_list)
post.uta.90 <- cleaning(post90,'UTA',my_list)
reg00 <- filter_teams2(2000,2010,regular_season,'LAL','BOS','DET','SAS')
post00 <- filter_teams2(2000,2010,playoff_games,'LAL','BOS','DET','SAS')
reg.bos.00 <- cleaning(reg00,'BOS',my_list)
post.bos.00 <- cleaning(post00,'BOS',my_list)
reg.det.00 <- cleaning(reg00,'DET',my_list)
post.det.00 <- cleaning(post00,'DET',my_list)
reg.lal.00 <- cleaning(reg00,'LAL',my_list)
post.lal.00 <- cleaning(post00,'LAL',my_list)
reg.sas.00 <- cleaning(reg00,'SAS',my_list)
post.sas.00 <- cleaning(post00,'SAS',my_list)
reg10 <- filter_teams2(2010,2020,regular_season,'MIA','CLE','GSW','SAS')
post10 <- filter_teams2(2010,2020,playoff_games,'MIA','CLE','GWS','SAS')
reg.mia.10 <- cleaning(reg10,'MIA',my_list)
post.mia.10 <- cleaning(post10,'MIA',my_list)
reg.cle.10 <- cleaning(reg10,'CLE',my_list)
post.cle.10 <- cleaning(post10,'CLE',my_list)
reg.gsw.10 <- cleaning(reg10,'GSW',my_list)
post.gsw.10 <- cleaning(post10,'GSW',my_list)
reg.sas.10 <- cleaning(reg10,'SAS',my_list)
post.sas.10 <- cleaning(post10,'SAS',my_list)
vorp <- function(df){
stats <- data.frame(NULL)
for(g in 1:nrow(df)){
id <- df$id[g]
team <- df$team[g]
node <- paste0("table#box-", team, "-game-advanced > tbody > tr > td")
node2 <- paste0("table#box-", team, "-game-advanced > tbody > tr > th")
url <- paste0("https://www.basketball-reference.com/boxscores/", id, ".html")
webpage <- read_html(url)
vorp <- webpage %>%
html_nodes(node) %>%
html_attr("data-tip") %>%
data.frame()
vorp <- vorp[-which(is.na(vorp[,1])),]
vorp <- data.frame(vorp)
colnames(vorp) <- "VORP"
for(i in 1:nrow(vorp)){
vorp$VORP[i] <- as.numeric(substr(vorp$VORP[i],
unlist(gregexpr("VORP", vorp$VORP[i]))[1] + 6,
unlist(gregexpr("VORP", vorp$VORP[i]))[2] - 17))
}
min <- webpage %>%
html_nodes(node) %>%
html_text() %>%
data.frame()
colnames(min) <- "min"
elim <- which(min$min == "Did Not Play")
if(length(elim) > 0){
min <- min[-elim,]
min <- data.frame(min)
colnames(min) <- "min"
}
elim <- which(min$min == "Did Not Dress")
if(length(elim) > 0){
min <- min[-elim,]
min <- data.frame(min)
colnames(min) <- "min"
}
elim <- which(min$min == "Inactive")
if(length(elim) > 0){
min <- min[-elim,]
min <- data.frame(min)
colnames(min) <- "min"
}
elim <- which(min$min == "Not With Team")
if(length(elim) > 0){
min <- min[-elim,]
min <- data.frame(min)
colnames(min) <- "min"
}
elim <- which(min$min == "Player Suspended")
if(length(elim) > 0){
min <- min[-elim,]
min <- data.frame(min)
colnames(min) <- "min"
}
min <- min[which(unlist(gregexpr(":", min$min)) > 0),]
min <- data.frame(min)
for(i in 1:nrow(min)){
min$sec[i] <- as.numeric(substr(min$min[i],
nchar(min$min[i]) - 1,
nchar(min$min[i])))
min$min[i] <- as.numeric(substr(min$min[i],
1 ,
nchar(min$min[i]) - 3))
if(is.na(min$sec[i])){
min$sec[i] <- 0
}
}
min$min <- as.numeric(min$min)
min$min <- min$min + (min$sec / 60)
min <- min %>%
select(1)
player <- webpage %>%
html_nodes(node2) %>%
html_attr("data-append-csv") %>%
matrix(ncol = 1, byrow = TRUE) %>%
data.frame()
player <- player[-which(is.na(player[,1])),]
player <- player[c(1:nrow(min))]
adder <- cbind(player, min, vorp)
adder <- adder[order(min, decreasing = TRUE),]
adder$id <- paste0(id, "-", team)
if(team == df$`Home/Neutral`[g]){
adder$opp_id <- paste0(id, "-", df$`Visitor/Neutral`[g])
} else {
adder$opp_id <- paste0(id, "-", df$`Home/Neutral`[g])
}
adder$season_id <- df$season_id[g]
adder$win <- df$win[g]
adder$year <- df$year[g]
adder$adj_VORP <- as.numeric(adder$VORP) * as.numeric(adder$min)
adder$avg_VORP <- mean(adder$adj_VORP)
stats <- rbind(stats, adder)
print(paste0(round((g/nrow(df)) * 100, 3),"%"))
Sys.sleep(5)
}
stats$link <- paste0(stats$player,"-",stats$year)
return(stats)
}
reg.chi.98 <- vorp(reg.chi.90[[1]])
post.chi.90
testing <- function(list,years){
holder <- 1
for(i in list){
temp <- vorp(i)
write_csv(temp,years[holder])
}
}
testing(post.chi.90,chi.post.years)
chi.post.years <- c('bulls.post98.csv','bulls.post90.csv','bulls.post91.csv','bulls.post92.csv','bulls.post93.csv',
'bulls.post94.csv','bulls.post95.csv','bulls.post96.csv','bulls.post97.csv')
testing(post.chi.90,chi.post.years)
testing <- function(list,years){
holder <- 1
for(i in list){
temp <- vorp(i)
write_csv(temp,years[holder])
holder <- holder + 1
}
}
testing(post.chi.90,chi.post.years)
read_csv('bulls.post92.csv')
ind.years <- function(list,years){
holder <- 1
for(i in list){
temp <- vorp(i)
write_csv(temp,years[holder])
holder <- holder + 1
}
}
post.bos.80
post.det.80
bos.post.80years <- c('celtics.post85.csv','celtics.post88.csv','celtics.post89.csv','celtics.post86.csv','celtics.post87.csv')
det.post.80years
chi.post.90years <- c('bulls.post98.csv','bulls.post90.csv','bulls.post91.csv','bulls.post92.csv','bulls.post93.csv',
'bulls.post94.csv','bulls.post95.csv','bulls.post96.csv','bulls.post97.csv')
det.post.80years <- c('pistons.post85.csv','pistons.post88.csv','pistons.post89.csv','pistons.post86.csv','pistons.post87.csv')
post.lal.80
post.hou.90
post.uta.90
post.bos.00
post.det.00
post.lal.00
